---
version: "3"

tasks:
  update-flake-lock:
    desc: Update flake.lock
    cmds:
      - >
        nix
        --accept-flake-config
        --extra-experimental-features 'nix-command flakes'
        --no-warn-dirty
        flake
        update
        {{.CLI_ARGS}}
  fmt:
    desc: Format files
    cmds:
      - >
        trunk
        fmt
        {{.CLI_ARGS}}
  lint:
    desc: Lint files
    cmds:
      - >
        trunk
        check
        {{.CLI_ARGS}}
  clean:
    desc: Clean the project
    cmds:
      - >
        rm
        --recursive
        --force
        {{.CLI_ARGS}}
        ./build/
  build:
    desc: Build the project
    deps:
      - task: clean
        vars:
          CLI_ARGS: ""
    env:
      GIT_CONFIG_COUNT: 1
      GIT_CONFIG_KEY_0: commit.gpgsign
      GIT_CONFIG_VALUE_0: false
    cmds:
      - >
        copier
        --overwrite
        --defaults
        --vcs-ref HEAD
        --data 'username=quickplates'
        --data 'project_name=template'
        --data 'description=Project template'
        {{.CLI_ARGS}}
        ./
        ./build/
  test:
    desc: Test the project
    dir: tests
    cmds:
      - >
        pytest
        {{.CLI_ARGS}}
